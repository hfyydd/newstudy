# å­¦ä¹ ä¸­å¿ƒè¯æ¡å­˜å‚¨å’Œé€»è¾‘è¯´æ˜

## ğŸ“ å­˜å‚¨ä½ç½®

**è¯æ¡å­˜å‚¨åœ¨ SQLite æ•°æ®åº“ä¸­**ï¼Œå…·ä½“ä½ç½®ï¼š
- **æ•°æ®åº“æ–‡ä»¶**ï¼š`backend/notes.db`
- **æ•°æ®è¡¨**ï¼š`flash_cards` è¡¨

## ğŸ—„ï¸ æ•°æ®åº“è¡¨ç»“æ„

### `flash_cards` è¡¨

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| `id` | TEXT | å¡ç‰‡å”¯ä¸€IDï¼ˆUUIDï¼‰ |
| `note_id` | TEXT | æ‰€å±ç¬”è®°IDï¼ˆå¤–é”®ï¼Œå…³è” `notes.id`ï¼‰ |
| `term` | TEXT | è¯æ¡å†…å®¹ï¼ˆå¦‚ï¼š"æ¢¯åº¦ä¸‹é™"ã€"ç¥ç»ç½‘ç»œ"ï¼‰ |
| `status` | TEXT | å­¦ä¹ çŠ¶æ€ï¼ˆè§ä¸‹æ–¹çŠ¶æ€è¯´æ˜ï¼‰ |
| `created_at` | TEXT | åˆ›å»ºæ—¶é—´ï¼ˆISO 8601æ ¼å¼ï¼‰ |
| `last_reviewed_at` | TEXT | æœ€åå¤ä¹ æ—¶é—´ï¼ˆå¯ä¸ºç©ºï¼‰ |

**çº¦æŸ**ï¼š
- `UNIQUE(note_id, term)`ï¼šåŒä¸€ç¬”è®°ä¸­ï¼Œè¯æ¡ä¸èƒ½é‡å¤
- `FOREIGN KEY (note_id) REFERENCES notes(id) ON DELETE CASCADE`ï¼šåˆ é™¤ç¬”è®°æ—¶ï¼Œçº§è”åˆ é™¤å…³è”çš„è¯æ¡

## ğŸ“Š å­¦ä¹ çŠ¶æ€ï¼ˆstatusï¼‰æšä¸¾

è¯æ¡æœ‰ 4 ç§å­¦ä¹ çŠ¶æ€ï¼š

| çŠ¶æ€å€¼ | è¯´æ˜ | æ˜¯å¦åœ¨å­¦ä¹ ä¸­å¿ƒæ˜¾ç¤º |
|--------|------|-------------------|
| `notStarted` | æœªå¼€å§‹å­¦ä¹ ï¼ˆé»˜è®¤çŠ¶æ€ï¼‰ | âŒ ä¸æ˜¾ç¤º |
| `needsReview` | éœ€è¦å¤ä¹ ï¼ˆå›°éš¾è¯æ¡ï¼‰ | âœ… **æ˜¾ç¤º** |
| `needsImprove` | éœ€è¦æ”¹è¿›ï¼ˆä¸­ç­‰éš¾åº¦ï¼‰ | âœ… **æ˜¾ç¤º** |
| `mastered` | å·²æŒæ¡ | âš ï¸ ä»…åœ¨"å·²æŒæ¡"ç­›é€‰æ—¶æ˜¾ç¤º |

## ğŸ”„ æ•°æ®æµè½¬æµç¨‹

### 1. è¯æ¡ç”Ÿæˆæµç¨‹

```
ç”¨æˆ·åˆ›å»ºç¬”è®°
    â†“
ç‚¹å‡»"ç”Ÿæˆé—ªè¯å¡ç‰‡"æŒ‰é’®
    â†“
POST /notes/{note_id}/flash-cards/generate
    â†“
AI ä»ç¬”è®°å†…å®¹ä¸­æå–è¯æ¡ï¼ˆ10-30ä¸ªï¼‰
    â†“
db.create_flash_cards(note_id, terms)
    â†“
INSERT INTO flash_cards (id, note_id, term, status='notStarted', ...)
    â†“
è¯æ¡ä¿å­˜åˆ°æ•°æ®åº“
```

### 2. å­¦ä¹ ä¸­å¿ƒæŸ¥è¯¢æµç¨‹

```
ç”¨æˆ·è¿›å…¥å­¦ä¹ ä¸­å¿ƒé¡µé¢
    â†“
ReviewController.loadReviewCards()
    â†“
GET /review/cards
    â†“
db.get_review_flash_cards()
    â†“
SELECT * FROM flash_cards 
WHERE status IN ('needsReview', 'needsImprove')
ORDER BY status, created_at
    â†“
å…³è”æŸ¥è¯¢ notes è¡¨è·å–ç¬”è®°æ ‡é¢˜
    â†“
è¿”å›è¯æ¡åˆ—è¡¨ï¼ˆæŒ‰ç¬”è®°åˆ†ç»„æ˜¾ç¤ºï¼‰
```

### 3. çŠ¶æ€æ›´æ–°æµç¨‹

```
ç”¨æˆ·åœ¨è´¹æ›¼å­¦ä¹ é¡µé¢æ ‡è®°è¯æ¡çŠ¶æ€
    â†“
PUT /notes/{note_id}/flash-cards/status
    â†“
db.update_flash_card_status(note_id, term, status)
    â†“
UPDATE flash_cards 
SET status = ?, last_reviewed_at = NOW()
WHERE note_id = ? AND term = ?
    â†“
çŠ¶æ€ä¿å­˜åˆ°æ•°æ®åº“
```

## ğŸ¯ å­¦ä¹ ä¸­å¿ƒçš„ç­›é€‰é€»è¾‘

å­¦ä¹ ä¸­å¿ƒé¡µé¢æœ‰ 4 ä¸ªç­›é€‰æ ‡ç­¾ï¼š

### 1. ä»Šæ—¥å¤ä¹ ï¼ˆé»˜è®¤ï¼‰
```dart
filteredCards = reviewCards.where((card) =>
    card.status == 'needsReview' || card.status == 'needsImprove'
).toList();
```
- æ˜¾ç¤ºæ‰€æœ‰ `needsReview` å’Œ `needsImprove` çŠ¶æ€çš„è¯æ¡

### 2. å›°éš¾è¯æ¡
```dart
filteredCards = reviewCards.where((card) =>
    card.status == 'needsReview' || card.status == 'needsImprove'
).toList();
```
- ä¸"ä»Šæ—¥å¤ä¹ "ç›¸åŒï¼Œæ˜¾ç¤ºéœ€è¦å¤ä¹ çš„è¯æ¡

### 3. å·²æŒæ¡
```dart
filteredCards = reviewCards.where((card) =>
    card.status == 'mastered'
).toList();
```
- æ˜¾ç¤ºæ‰€æœ‰ `mastered` çŠ¶æ€çš„è¯æ¡

### 4. å…¨éƒ¨
```dart
filteredCards = reviewCards.toList();
```
- æ˜¾ç¤ºæ‰€æœ‰è¯æ¡ï¼ˆåŒ…æ‹¬æ‰€æœ‰çŠ¶æ€ï¼‰

**æ³¨æ„**ï¼šå­¦ä¹ ä¸­å¿ƒé»˜è®¤åªä»åç«¯è·å– `needsReview` å’Œ `needsImprove` çŠ¶æ€çš„è¯æ¡ï¼Œæ‰€ä»¥"å·²æŒæ¡"å’Œ"å…¨éƒ¨"ç­›é€‰å¯èƒ½æ˜¾ç¤ºä¸å®Œæ•´ã€‚å¦‚æœéœ€è¦æ˜¾ç¤ºæ‰€æœ‰çŠ¶æ€çš„è¯æ¡ï¼Œéœ€è¦ä¿®æ”¹åç«¯ APIã€‚

## ğŸ“ å…³é”®ä»£ç ä½ç½®

### åç«¯
- **æ•°æ®åº“æŸ¥è¯¢**ï¼š`backend/database.py` â†’ `get_review_flash_cards()`
- **API æ¥å£**ï¼š`backend/server.py` â†’ `GET /review/cards`
- **çŠ¶æ€æ›´æ–°**ï¼š`backend/database.py` â†’ `update_flash_card_status()`

### å‰ç«¯
- **æ§åˆ¶å™¨**ï¼š`newstudyapp/lib/pages/review/review_controller.dart`
- **çŠ¶æ€ç®¡ç†**ï¼š`newstudyapp/lib/pages/review/review_state.dart`
- **API è°ƒç”¨**ï¼š`newstudyapp/lib/services/http_service.dart` â†’ `getReviewFlashCards()`

## ğŸ” å½“å‰æ•°æ®åº“çŠ¶æ€

æ ¹æ®æŸ¥è¯¢ç»“æœï¼Œå½“å‰æ•°æ®åº“ä¸­æœ‰ï¼š
- `notStarted`ï¼š34 ä¸ªè¯æ¡ï¼ˆæœªå¼€å§‹å­¦ä¹ ï¼‰
- `needsReview`ï¼š20 ä¸ªè¯æ¡ï¼ˆéœ€è¦å¤ä¹ ï¼‰
- `needsImprove`ï¼š20 ä¸ªè¯æ¡ï¼ˆéœ€è¦æ”¹è¿›ï¼‰
- `mastered`ï¼š30 ä¸ªè¯æ¡ï¼ˆå·²æŒæ¡ï¼‰

**å­¦ä¹ ä¸­å¿ƒé»˜è®¤æ˜¾ç¤º**ï¼š20 + 20 = **40 ä¸ªè¯æ¡**ï¼ˆ`needsReview` + `needsImprove`ï¼‰

## ğŸ’¡ æ€»ç»“

1. **å­˜å‚¨ä½ç½®**ï¼šè¯æ¡å­˜å‚¨åœ¨ SQLite æ•°æ®åº“çš„ `flash_cards` è¡¨ä¸­
2. **æ•°æ®æ¥æº**ï¼šä»ç¬”è®°å†…å®¹ä¸­é€šè¿‡ AI æå–ç”Ÿæˆ
3. **å­¦ä¹ ä¸­å¿ƒé€»è¾‘**ï¼šé»˜è®¤åªæ˜¾ç¤ºéœ€è¦å¤ä¹ çš„è¯æ¡ï¼ˆ`needsReview` + `needsImprove`ï¼‰
4. **çŠ¶æ€ç®¡ç†**ï¼šè¯æ¡çŠ¶æ€é€šè¿‡ `PUT /notes/{note_id}/flash-cards/status` æ¥å£æ›´æ–°
5. **æ•°æ®æŒä¹…åŒ–**ï¼šæ‰€æœ‰è¯æ¡å’Œå­¦ä¹ çŠ¶æ€éƒ½ä¿å­˜åœ¨åç«¯æ•°æ®åº“ä¸­
