# 复习时间间隔说明

## 📅 当前实现状态

### ❌ 未实现基于时间的复习间隔

**当前系统没有实现根据时间间隔自动判断是否需要复习的逻辑。**

### 当前行为

1. **"今日复习"显示逻辑**：
   - 显示所有 `needsReview`（需要复习/困难词条）状态的词条
   - 显示所有 `needsImprove`（需要改进）状态的词条
   - **不基于时间判断**，只要状态是这两个，就会显示

2. **时间字段**：
   - `last_reviewed_at`：记录最后复习时间（更新状态时自动更新）
   - **没有 `next_review_at` 字段**：没有下次复习时间
   - **没有 `review_schedule` 表**：没有复习计划表

3. **状态更新**：
   - 更新词条状态时，会更新 `last_reviewed_at` 为当前时间
   - 但不会计算下次复习时间
   - 不会根据时间间隔判断是否需要复习

---

## 📋 产品文档中的设计（未实现）

根据 `闪词学习产品文档.md`，原本设计了复习时间间隔：

| 状态 | 复习间隔 | next_review_at 计算 |
|------|---------|---------------------|
| 良好（needsReview） | **1天** | 当前时间 + 24小时 |
| 需改进（needsImprove） | **3天** | 当前时间 + 72小时 |
| 未掌握（notMastered） | **当天** | 当前时间 + 4小时 |
| 已掌握（mastered） | **7天** | 当前时间 + 7天 |

**但这些逻辑目前都没有实现。**

---

## 🔍 实际行为

### 示例场景

假设一个词条：
- 状态：`needsReview`
- `last_reviewed_at`：`2024-01-01 10:00:00`

**当前行为**：
- ✅ 会一直显示在"今日复习"中
- ❌ 不会因为已经过了1天就自动提醒
- ❌ 不会因为还没到1天就不显示

**如果实现了时间间隔逻辑**：
- 如果当前时间是 `2024-01-02 10:00:00`（已过1天）→ 应该显示
- 如果当前时间是 `2024-01-01 15:00:00`（还没过1天）→ 不应该显示

---

## 💡 建议实现

### 1. 添加 `review_schedule` 表（可选）

```sql
CREATE TABLE review_schedule (
  id TEXT PRIMARY KEY,
  card_id TEXT NOT NULL UNIQUE,
  next_review_at TEXT NOT NULL,  -- ISO 8601格式
  review_count INTEGER DEFAULT 0,
  FOREIGN KEY (card_id) REFERENCES flash_cards(id)
);
```

### 2. 更新状态时计算下次复习时间

```python
def update_flash_card_status(self, note_id: str, term: str, status: str):
    # 更新状态和最后复习时间
    now = datetime.now()
    
    # 根据状态计算下次复习时间
    if status == 'needsReview':
        next_review = now + timedelta(days=1)  # 1天后
    elif status == 'needsImprove':
        next_review = now + timedelta(days=3)  # 3天后
    elif status == 'mastered':
        next_review = now + timedelta(days=7)  # 7天后
    else:
        next_review = now + timedelta(hours=4)  # 4小时后
    
    # 更新或创建复习计划
    # ...
```

### 3. 查询时根据时间过滤

```sql
-- 查询需要复习的词条（基于时间）
SELECT fc.* 
FROM flash_cards fc
LEFT JOIN review_schedule rs ON fc.id = rs.card_id
WHERE fc.status IN ('needsReview', 'needsImprove')
  AND (rs.next_review_at IS NULL OR rs.next_review_at <= datetime('now'))
ORDER BY rs.next_review_at ASC
```

---

## 📊 总结

### 当前状态
- ❌ **没有实现基于时间的复习间隔**
- ✅ 有 `last_reviewed_at` 字段记录最后复习时间
- ✅ 更新状态时会自动更新 `last_reviewed_at`
- ❌ 没有 `next_review_at` 字段
- ❌ 没有 `review_schedule` 表
- ❌ "今日复习"不基于时间判断，只基于状态

### 产品设计（未实现）
- `needsReview`：1天后复习
- `needsImprove`：3天后复习
- `mastered`：7天后复习
- `notMastered`：4小时后复习

### 实际行为
- **"今日复习"会显示所有 `needsReview` 和 `needsImprove` 状态的词条**
- **不会根据时间间隔判断是否需要复习**
- **词条会一直显示，直到状态改变**

---

## 🎯 回答用户问题

**问：会在多久进行复习？**

**答：**
1. **当前实现**：系统**没有实现基于时间的复习间隔**。"今日复习"会显示所有 `needsReview`（需要复习）和 `needsImprove`（需改进）状态的词条，**不会根据时间判断**。

2. **产品设计**（未实现）：
   - `needsReview`：**1天后**复习
   - `needsImprove`：**3天后**复习
   - `mastered`：**7天后**复习

3. **实际行为**：词条会一直显示在"今日复习"中，直到状态改变（例如：标记为已掌握）。

4. **建议**：如果需要实现基于时间的复习间隔，需要：
   - 添加 `review_schedule` 表或 `next_review_at` 字段
   - 更新状态时计算下次复习时间
   - 查询时根据时间过滤
