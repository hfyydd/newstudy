# ä»Šæ—¥å¤ä¹ å’Œå›°éš¾è¯æ¡é€»è¾‘è¯´æ˜

## ğŸ“Š ä»Šæ—¥å¤ä¹ çš„é€»è¾‘

### 1. å®šä¹‰
**ä»Šæ—¥å¤ä¹ **æ˜¾ç¤ºæ‰€æœ‰éœ€è¦å¤ä¹ çš„è¯æ¡ï¼ŒåŒ…æ‹¬ï¼š
- `needsReview`ï¼ˆéœ€è¦å¤ä¹ /å›°éš¾è¯æ¡ï¼‰
- `needsImprove`ï¼ˆéœ€è¦æ”¹è¿›ï¼‰

### 2. æ•°æ®æ¥æº
```sql
-- ç»Ÿè®¡éœ€è¦å¤ä¹ çš„è¯æ¡æ€»æ•°
SELECT COUNT(*) FROM flash_cards 
WHERE status IN ('needsReview', 'needsImprove')

-- ç»Ÿè®¡å›°éš¾è¯æ¡æ•°
SELECT COUNT(*) FROM flash_cards 
WHERE status = 'needsReview'

-- ç»Ÿè®¡éœ€æ”¹è¿›è¯æ¡æ•°
SELECT COUNT(*) FROM flash_cards 
WHERE status = 'needsImprove'
```

### 3. å‰ç«¯æ˜¾ç¤ºé€»è¾‘
```dart
// ä»Šæ—¥å¤ä¹ ç­›é€‰
filteredCards = reviewCards.where((card) =>
    card.status == 'needsReview' || card.status == 'needsImprove'
).toList();
```

### 4. API æ¥å£
- **ç»Ÿè®¡æ¥å£**ï¼š`GET /review/today` â†’ è¿”å›ä»Šæ—¥å¤ä¹ ç»Ÿè®¡æ•°æ®
- **åˆ—è¡¨æ¥å£**ï¼š`GET /review/cards` â†’ è¿”å›éœ€è¦å¤ä¹ çš„è¯æ¡åˆ—è¡¨

---

## ğŸ¯ å›°éš¾è¯æ¡æ˜¯æ€ä¹ˆè®¾ç½®çš„ï¼Ÿ

### å½“å‰å®ç°çŠ¶æ€

#### âœ… å·²å®ç°çš„åŠŸèƒ½
1. **æ‰‹åŠ¨æ ‡è®°å·²æŒæ¡**
   - ç”¨æˆ·åœ¨è´¹æ›¼å­¦ä¹ é¡µé¢ç‚¹å‡»"æ ‡è®°å·²æŒæ¡"
   - è°ƒç”¨ `PUT /notes/{note_id}/flash-cards/status` API
   - å°†çŠ¶æ€è®¾ç½®ä¸º `mastered`

#### âŒ æœªå®ç°çš„åŠŸèƒ½
1. **è‡ªåŠ¨è®¾ç½®å›°éš¾è¯æ¡**
   - è´¹æ›¼å­¦ä¹ æµç¨‹ä¸­ï¼Œç”¨æˆ·æäº¤è§£é‡Šåï¼ŒAIä¼šåˆ¤æ–­æ˜¯å¦æœ‰ä¸æ¸…æ¥šçš„è¯æ±‡
   - ä½†**æ²¡æœ‰æ ¹æ®AIçš„åˆ¤æ–­ç»“æœè‡ªåŠ¨è®¾ç½®è¯æ¡çŠ¶æ€**
   - ç›®å‰å›°éš¾è¯æ¡çš„çŠ¶æ€æ˜¯é€šè¿‡æµ‹è¯•æ•°æ®éšæœºåˆ†é…çš„

2. **æ ¹æ®å­¦ä¹ ç»“æœè‡ªåŠ¨æ›´æ–°çŠ¶æ€**
   - å­¦ä¹ æˆåŠŸï¼ˆAIåˆ¤æ–­ä¸ºclearï¼‰â†’ åº”è¯¥è®¾ç½®ä¸º `mastered` æˆ– `needsReview`
   - å­¦ä¹ å¤±è´¥ï¼ˆæœ‰ä¸æ¸…æ¥šçš„è¯æ±‡ï¼‰â†’ åº”è¯¥è®¾ç½®ä¸º `needsReview` æˆ– `needsImprove`
   - ç›®å‰è¿™äº›é€»è¾‘éƒ½**æ²¡æœ‰å®ç°**

### è¯æ¡çŠ¶æ€æšä¸¾

| çŠ¶æ€å€¼ | è¯´æ˜ | å¦‚ä½•è®¾ç½® | å½“å‰çŠ¶æ€ |
|--------|------|----------|----------|
| `notStarted` | æœªå¼€å§‹å­¦ä¹  | åˆ›å»ºè¯æ¡æ—¶é»˜è®¤çŠ¶æ€ | âœ… å·²å®ç° |
| `needsReview` | éœ€è¦å¤ä¹ ï¼ˆå›°éš¾è¯æ¡ï¼‰ | **æ‰‹åŠ¨è®¾ç½®**ï¼ˆæœªå®ç°è‡ªåŠ¨ï¼‰ | âš ï¸ éƒ¨åˆ†å®ç° |
| `needsImprove` | éœ€è¦æ”¹è¿›ï¼ˆä¸­ç­‰éš¾åº¦ï¼‰ | **æ‰‹åŠ¨è®¾ç½®**ï¼ˆæœªå®ç°è‡ªåŠ¨ï¼‰ | âš ï¸ éƒ¨åˆ†å®ç° |
| `mastered` | å·²æŒæ¡ | ç”¨æˆ·ç‚¹å‡»"æ ‡è®°å·²æŒæ¡" | âœ… å·²å®ç° |

### å½“å‰çŠ¶æ€è®¾ç½®æµç¨‹

```
ç”¨æˆ·åˆ›å»ºç¬”è®°
    â†“
ç”Ÿæˆé—ªè¯å¡ç‰‡
    â†“
è¯æ¡çŠ¶æ€ = 'notStarted'ï¼ˆé»˜è®¤ï¼‰
    â†“
ç”¨æˆ·åœ¨è´¹æ›¼å­¦ä¹ é¡µé¢å­¦ä¹ 
    â†“
ç”¨æˆ·ç‚¹å‡»"æ ‡è®°å·²æŒæ¡"
    â†“
çŠ¶æ€æ›´æ–°ä¸º 'mastered' âœ…
```

**é—®é¢˜**ï¼šå¦‚æœç”¨æˆ·å­¦ä¹ å¤±è´¥ï¼ˆæœ‰ä¸æ¸…æ¥šçš„è¯æ±‡ï¼‰ï¼Œè¯æ¡çŠ¶æ€**ä¸ä¼šè‡ªåŠ¨æ›´æ–°**ä¸º `needsReview` æˆ– `needsImprove`ã€‚

---

## ğŸ”„ åº”è¯¥å®ç°çš„é€»è¾‘ï¼ˆå»ºè®®ï¼‰

### 1. æ ¹æ®å­¦ä¹ ç»“æœè‡ªåŠ¨æ›´æ–°çŠ¶æ€

```
ç”¨æˆ·åœ¨è´¹æ›¼å­¦ä¹ é¡µé¢æäº¤è§£é‡Š
    â†“
AIåˆ¤æ–­ç»“æœï¼š
  - status = 'clear'ï¼ˆç†è§£æ¸…æ¥šï¼‰
    â†’ çŠ¶æ€æ›´æ–°ä¸º 'mastered' æˆ–ä¿æŒå½“å‰çŠ¶æ€
  - status = 'confused'ï¼ˆæœ‰ä¸æ¸…æ¥šçš„è¯æ±‡ï¼‰
    â†’ çŠ¶æ€æ›´æ–°ä¸º 'needsReview' æˆ– 'needsImprove'
    â†“
è°ƒç”¨ PUT /notes/{note_id}/flash-cards/status API
    â†“
æ›´æ–°æ•°æ®åº“ä¸­çš„çŠ¶æ€
```

### 2. çŠ¶æ€è½¬æ¢è§„åˆ™ï¼ˆå»ºè®®ï¼‰

| å­¦ä¹ ç»“æœ | å½“å‰çŠ¶æ€ | æ–°çŠ¶æ€ | è¯´æ˜ |
|----------|----------|--------|------|
| AIåˆ¤æ–­ä¸ºclear | `notStarted` | `mastered` | é¦–æ¬¡å­¦ä¹ å°±ç†è§£æ¸…æ¥š |
| AIåˆ¤æ–­ä¸ºclear | `needsReview` | `mastered` | å›°éš¾è¯æ¡å·²æŒæ¡ |
| AIåˆ¤æ–­ä¸ºclear | `needsImprove` | `mastered` | éœ€æ”¹è¿›è¯æ¡å·²æŒæ¡ |
| AIåˆ¤æ–­ä¸ºconfused | `notStarted` | `needsReview` | é¦–æ¬¡å­¦ä¹ å°±æœ‰å›°éš¾ |
| AIåˆ¤æ–­ä¸ºconfused | `needsReview` | `needsReview` | ä»ç„¶æ˜¯å›°éš¾è¯æ¡ |
| AIåˆ¤æ–­ä¸ºconfused | `needsImprove` | `needsReview` | éœ€æ”¹è¿›å˜æˆå›°éš¾ |
| AIåˆ¤æ–­ä¸ºconfused | `mastered` | `needsReview` | å·²æŒæ¡ä½†å¤ä¹ æ—¶åˆå›°éš¾ |

### 3. å¤ä¹ æ—¶é—´ç®¡ç†ï¼ˆå»ºè®®ï¼‰

- å½“çŠ¶æ€æ›´æ–°ä¸º `needsReview` æˆ– `needsImprove` æ—¶ï¼Œæ›´æ–° `last_reviewed_at`
- æ ¹æ® `last_reviewed_at` å’ŒçŠ¶æ€ï¼Œè®¡ç®—æ˜¯å¦éœ€è¦å¤ä¹ 
- ä¾‹å¦‚ï¼š`needsReview` çŠ¶æ€1å¤©åéœ€è¦å¤ä¹ ï¼Œ`needsImprove` çŠ¶æ€3å¤©åéœ€è¦å¤ä¹ 

---

## ğŸ“ å…³é”®ä»£ç ä½ç½®

### åç«¯
- **çŠ¶æ€æ›´æ–°API**ï¼š`backend/server.py` â†’ `PUT /notes/{note_id}/flash-cards/status`
- **æ•°æ®åº“æ›´æ–°**ï¼š`backend/database.py` â†’ `update_flash_card_status()`
- **ä»Šæ—¥å¤ä¹ ç»Ÿè®¡**ï¼š`backend/database.py` â†’ `get_today_review_statistics()`

### å‰ç«¯
- **æ ‡è®°å·²æŒæ¡**ï¼š`newstudyapp/lib/pages/feynman_learning/feynman_learning_controller.dart` â†’ `markAsMastered()`
- **æäº¤è§£é‡Š**ï¼š`newstudyapp/lib/pages/feynman_learning/feynman_learning_controller.dart` â†’ `handleTextSubmit()`
- **å­¦ä¹ ä¸­å¿ƒç­›é€‰**ï¼š`newstudyapp/lib/pages/review/review_state.dart` â†’ `filteredCards`

---

## ğŸ¯ æ€»ç»“

### ä»Šæ—¥å¤ä¹ é€»è¾‘
- âœ… **å·²å®ç°**ï¼šæ˜¾ç¤ºæ‰€æœ‰ `needsReview` å’Œ `needsImprove` çŠ¶æ€çš„è¯æ¡
- âœ… **å·²å®ç°**ï¼šç»Ÿè®¡ä»Šæ—¥éœ€è¦å¤ä¹ çš„è¯æ¡æ•°é‡
- âœ… **å·²å®ç°**ï¼šæŒ‰ç¬”è®°åˆ†ç»„æ˜¾ç¤º

### å›°éš¾è¯æ¡è®¾ç½®
- âœ… **å·²å®ç°**ï¼šæ‰‹åŠ¨æ ‡è®°ä¸ºå·²æŒæ¡ï¼ˆ`mastered`ï¼‰
- âŒ **æœªå®ç°**ï¼šæ ¹æ®å­¦ä¹ ç»“æœè‡ªåŠ¨è®¾ç½®å›°éš¾è¯æ¡çŠ¶æ€
- âŒ **æœªå®ç°**ï¼šæ ¹æ®AIåˆ¤æ–­ç»“æœè‡ªåŠ¨æ›´æ–°çŠ¶æ€
- âš ï¸ **å½“å‰çŠ¶æ€**ï¼šå›°éš¾è¯æ¡çš„çŠ¶æ€æ˜¯é€šè¿‡æµ‹è¯•æ•°æ®éšæœºåˆ†é…çš„

### å»ºè®®æ”¹è¿›
1. åœ¨è´¹æ›¼å­¦ä¹ æµç¨‹ä¸­ï¼Œæ ¹æ®AIåˆ¤æ–­ç»“æœè‡ªåŠ¨æ›´æ–°è¯æ¡çŠ¶æ€
2. å­¦ä¹ æˆåŠŸï¼ˆclearï¼‰â†’ è®¾ç½®ä¸º `mastered`
3. å­¦ä¹ å¤±è´¥ï¼ˆconfusedï¼‰â†’ è®¾ç½®ä¸º `needsReview` æˆ– `needsImprove`
4. æ ¹æ®å¤ä¹ æ—¶é—´å’ŒçŠ¶æ€ï¼Œæ™ºèƒ½æ¨èéœ€è¦å¤ä¹ çš„è¯æ¡
