# è´¹æ›¼å­¦ä¹ è‡ªåŠ¨æ›´æ–°è¯æ¡çŠ¶æ€åŠŸèƒ½ - æ”¹è¿›å®Œæˆè¯´æ˜

## âœ… å·²å®Œæˆçš„æ”¹è¿›

### 1. å­¦ä¹ æˆåŠŸæ—¶è‡ªåŠ¨è®¾ç½®ä¸ºå·²æŒæ¡
- **ä½ç½®**ï¼š`feynman_learning_controller.dart` â†’ `_updateCardStatusOnSuccess()`
- **è§¦å‘æ¡ä»¶**ï¼šAIåˆ¤æ–­ä¸º `status = 'clear'`ï¼ˆå­¦ä¹ æˆåŠŸï¼‰
- **è¡Œä¸º**ï¼š
  - è‡ªåŠ¨è°ƒç”¨ `updateFlashCardStatus(noteId, term, 'mastered')`
  - æ›´æ–°è¯æ¡çŠ¶æ€ä¸º `mastered`
  - æ›´æ–° `last_reviewed_at` æ—¶é—´æˆ³ï¼ˆåç«¯è‡ªåŠ¨å¤„ç†ï¼‰
  - æ·»åŠ åˆ°æœ¬åœ°å·²æŒæ¡é›†åˆï¼ˆç”¨äºUIæ˜¾ç¤ºï¼‰

### 2. å­¦ä¹ å¤±è´¥æ—¶è‡ªåŠ¨è®¾ç½®ä¸ºéœ€è¦å¤ä¹ 
- **ä½ç½®**ï¼š`feynman_learning_controller.dart` â†’ `_updateCardStatusOnFailure()`
- **è§¦å‘æ¡ä»¶**ï¼šAIåˆ¤æ–­ä¸º `status = 'confused'`ï¼ˆæœ‰ä¸æ¸…æ¥šçš„è¯æ±‡ï¼‰
- **è¡Œä¸º**ï¼š
  - è‡ªåŠ¨è°ƒç”¨ `updateFlashCardStatus(noteId, term, 'needsReview')`
  - æ›´æ–°è¯æ¡çŠ¶æ€ä¸º `needsReview`ï¼ˆå›°éš¾è¯æ¡ï¼‰
  - æ›´æ–° `last_reviewed_at` æ—¶é—´æˆ³ï¼ˆåç«¯è‡ªåŠ¨å¤„ç†ï¼‰

### 3. é›†æˆåˆ°å­¦ä¹ æµç¨‹
- **ä½ç½®**ï¼š`feynman_learning_controller.dart` â†’ `handleTextSubmit()`
- **æµç¨‹**ï¼š
  1. ç”¨æˆ·æäº¤è§£é‡Š
  2. AIåˆ¤æ–­ç»“æœ
  3. å¦‚æœ `isClear = true` â†’ è°ƒç”¨ `_updateCardStatusOnSuccess()`
  4. å¦‚æœæœ‰ä¸æ¸…æ¥šçš„è¯æ±‡ â†’ è°ƒç”¨ `_updateCardStatusOnFailure()`

## ğŸ“ ä»£ç å˜æ›´

### æ–°å¢æ–¹æ³•

```dart
/// æ ¹æ®å­¦ä¹ ç»“æœè‡ªåŠ¨æ›´æ–°è¯æ¡çŠ¶æ€ï¼ˆå­¦ä¹ æˆåŠŸï¼‰
Future<void> _updateCardStatusOnSuccess() async {
  // å­¦ä¹ æˆåŠŸï¼Œè®¾ç½®ä¸ºå·²æŒæ¡
  await httpService.updateFlashCardStatus(noteId, currentTerm, 'mastered');
  // æ·»åŠ åˆ°å·²æŒæ¡é›†åˆï¼ˆç”¨äºUIæ˜¾ç¤ºï¼‰
  state.masteredTerms.add(currentTerm);
}

/// æ ¹æ®å­¦ä¹ ç»“æœè‡ªåŠ¨æ›´æ–°è¯æ¡çŠ¶æ€ï¼ˆå­¦ä¹ å¤±è´¥ï¼‰
Future<void> _updateCardStatusOnFailure() async {
  // å­¦ä¹ å¤±è´¥ï¼Œè®¾ç½®ä¸ºéœ€è¦å¤ä¹ ï¼ˆå›°éš¾è¯æ¡ï¼‰
  await httpService.updateFlashCardStatus(noteId, currentTerm, 'needsReview');
}
```

### ä¿®æ”¹çš„æ–¹æ³•

```dart
Future<void> handleTextSubmit(String text) async {
  // ... åŸæœ‰é€»è¾‘ ...
  
  if (extracted.isEmpty) {
    if (extraction.isClear) {
      // ğŸ‰ å­¦ä¹ æˆåŠŸï¼æ˜¾ç¤ºæˆåŠŸç•Œé¢
      state.learningPhase.value = LearningPhase.success;
      // è‡ªåŠ¨æ›´æ–°è¯æ¡çŠ¶æ€ä¸ºå·²æŒæ¡
      await _updateCardStatusOnSuccess(); // âœ… æ–°å¢
    }
    return;
  }

  // æœ‰ä¸æ¸…æ¥šçš„è¯æ±‡ï¼Œè¿›å…¥ reviewing é˜¶æ®µ
  state.confusedWords.value = List.of(extracted);
  state.learningPhase.value = LearningPhase.reviewing;
  // è‡ªåŠ¨æ›´æ–°è¯æ¡çŠ¶æ€ä¸ºéœ€è¦å¤ä¹ 
  await _updateCardStatusOnFailure(); // âœ… æ–°å¢
}
```

## ğŸ¯ æ•ˆæœ

### ä¹‹å‰
- å›°éš¾è¯æ¡çš„çŠ¶æ€æ˜¯é€šè¿‡æµ‹è¯•æ•°æ®éšæœºåˆ†é…çš„
- å­¦ä¹ ç»“æœä¸ä¼šè‡ªåŠ¨æ›´æ–°è¯æ¡çŠ¶æ€
- éœ€è¦æ‰‹åŠ¨ç‚¹å‡»"æ ‡è®°å·²æŒæ¡"æ‰èƒ½æ›´æ–°çŠ¶æ€

### ç°åœ¨
- âœ… å­¦ä¹ æˆåŠŸï¼ˆAIåˆ¤æ–­ä¸ºclearï¼‰â†’ è‡ªåŠ¨è®¾ç½®ä¸º `mastered`
- âœ… å­¦ä¹ å¤±è´¥ï¼ˆæœ‰ä¸æ¸…æ¥šçš„è¯æ±‡ï¼‰â†’ è‡ªåŠ¨è®¾ç½®ä¸º `needsReview`
- âœ… è‡ªåŠ¨æ›´æ–° `last_reviewed_at` æ—¶é—´æˆ³
- âœ… å›°éš¾è¯æ¡æ ¹æ®å®é™…å­¦ä¹ ç»“æœè‡ªåŠ¨è®¾ç½®ï¼Œä¸å†éšæœºåˆ†é…

## ğŸ”„ çŠ¶æ€æµè½¬

```
ç”¨æˆ·æäº¤è§£é‡Š
    â†“
AIåˆ¤æ–­ç»“æœ
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  status='clear' â”‚ status='confused'â”‚
â”‚  (å­¦ä¹ æˆåŠŸ)      â”‚  (å­¦ä¹ å¤±è´¥)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“                    â†“
è®¾ç½®ä¸ºmastered      è®¾ç½®ä¸ºneedsReview
    â†“                    â†“
æ›´æ–°last_reviewed_at  æ›´æ–°last_reviewed_at
    â†“                    â†“
æ˜¾ç¤ºæˆåŠŸç•Œé¢          æ˜¾ç¤ºä¸æ¸…æ¥šè¯æ±‡åˆ—è¡¨
```

## ğŸ“Š æ•°æ®å½±å“

- **ä»Šæ—¥å¤ä¹ ç»Ÿè®¡**ï¼šä¼šæ ¹æ®å®é™…å­¦ä¹ ç»“æœè‡ªåŠ¨æ›´æ–°
- **å›°éš¾è¯æ¡åˆ—è¡¨**ï¼šä¼šæ˜¾ç¤ºçœŸæ­£éœ€è¦å¤ä¹ çš„è¯æ¡
- **å­¦ä¹ è¿›åº¦**ï¼šä¼šå‡†ç¡®åæ˜ ç”¨æˆ·çš„å­¦ä¹ çŠ¶æ€

## ğŸ§ª æµ‹è¯•å»ºè®®

1. **æµ‹è¯•å­¦ä¹ æˆåŠŸåœºæ™¯**ï¼š
   - æäº¤ä¸€ä¸ªæ¸…æ™°çš„è§£é‡Š
   - éªŒè¯è¯æ¡çŠ¶æ€æ˜¯å¦è‡ªåŠ¨æ›´æ–°ä¸º `mastered`
   - éªŒè¯ `last_reviewed_at` æ˜¯å¦æ›´æ–°

2. **æµ‹è¯•å­¦ä¹ å¤±è´¥åœºæ™¯**ï¼š
   - æäº¤ä¸€ä¸ªä¸æ¸…æ™°çš„è§£é‡Šï¼ˆåŒ…å«ä¸æ¸…æ¥šçš„è¯æ±‡ï¼‰
   - éªŒè¯è¯æ¡çŠ¶æ€æ˜¯å¦è‡ªåŠ¨æ›´æ–°ä¸º `needsReview`
   - éªŒè¯ `last_reviewed_at` æ˜¯å¦æ›´æ–°

3. **æµ‹è¯•å­¦ä¹ ä¸­å¿ƒ**ï¼š
   - è¿›å…¥å­¦ä¹ ä¸­å¿ƒï¼ŒæŸ¥çœ‹"ä»Šæ—¥å¤ä¹ "å’Œ"å›°éš¾è¯æ¡"
   - éªŒè¯æ˜¾ç¤ºçš„æ˜¯å¦æ˜¯çœŸæ­£éœ€è¦å¤ä¹ çš„è¯æ¡

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **é™é»˜å¤±è´¥**ï¼šå¦‚æœè‡ªåŠ¨æ›´æ–°çŠ¶æ€å¤±è´¥ï¼Œä¸ä¼šæ˜¾ç¤ºé”™è¯¯æç¤ºï¼Œé¿å…å¹²æ‰°ç”¨æˆ·ä½“éªŒ
2. **æœ¬åœ°çŠ¶æ€**ï¼šå·²æŒæ¡çš„è¯æ¡ä¼šæ·»åŠ åˆ°æœ¬åœ° `masteredTerms` é›†åˆï¼Œç”¨äºUIæ˜¾ç¤º
3. **è¯æ¡ä¿ç•™**ï¼šå­¦ä¹ æˆåŠŸåï¼Œè¯æ¡ä¸ä¼šä»åˆ—è¡¨ä¸­ç§»é™¤ï¼Œä½†ä¼šæ˜¾ç¤ºä¸ºå·²æŒæ¡çŠ¶æ€
